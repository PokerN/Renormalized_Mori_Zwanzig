function spectrum = energy_spectrum(u,M)

% make k array
k_vec = [0:M-1,-M:1:-1];
[kx,ky,kz] = ndgrid(k_vec,k_vec,k_vec);
k = zeros(2*M,2*M,2*M,3);
k(:,:,:,1) = kx;
k(:,:,:,2) = ky;
k(:,:,:,3) = kz;

k_mag = sum(k.^2,4);

k_min = min(k_mag(:));
k_max = max(k_mag(;